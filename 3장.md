# ✅ REAL MySQL 8.0 - 제3장 사용자 및 권한 관리

## 3.1 사용자 식별

- 사용자 계정 형식: `'user'@'host'`
- 예시:
  - `'svc_id'@'127.0.0.1'`
  - `'svc_id'@'192.168.0.10'` (비밀번호: 123)
  - `'svc_id'@'%'` (비밀번호: abc)

## 3.2 사용자 계정 관리

### 3.2.1 시스템 계정과 일반 계정

- 시스템 계정은 `SYSTEM_USER` 권한 보유
- 일반 계정은 시스템 계정 제어 불가
- 시스템 계정 권한:
  - 세션 종료
  - DEFINER 지정
  - 계정 관리

### 3.2.2 계정 생성

```sql
CREATE USER 'user'@'%'
IDENTIFIED WITH 'mysql_native_password' BY 'password'
REQUIRE NONE
PASSWORD EXPIRE INTERVAL 180 DAY
ACCOUNT UNLOCK
PASSWORD HISTORY 3
PASSWORD REUSE INTERVAL DEFAULT
PASSWORD REQUIRE CURRENT DEFAULT;
```

#### 주요 옵션 요약

- `IDENTIFIED WITH`: 인증 방식 지정
- `REQUIRE`: SSL/TLS 접속 요구
- `PASSWORD EXPIRE`: 비밀번호 유효기간
- `PASSWORD HISTORY`: 이전 비밀번호 이력 수
- `PASSWORD REUSE INTERVAL`: 재사용 금지 기간
- `PASSWORD REQUIRE`: 비밀번호 변경 시 현재 비밀번호 요구 여부
- `ACCOUNT LOCK / UNLOCK`: 계정 잠금 설정

## 3.3 비밀번호 관리

- 비밀번호 유효기간, 재사용 금지, 복잡성 정책 가능
- **이중 비밀번호 지원** (rotation 용도)

## 3.4 권한

### 권한 부여 구문

```sql
GRANT [권한목록] ON [db].[table] TO 'user'@'host';
```

### 권한 종류

- 글로벌 권한
  ```sql
  GRANT SUPER ON *.* TO 'user'@'localhost';
  ```
- DB 권한
  ```sql
  GRANT EVENT ON employees.* TO 'user'@'localhost';
  ```
- 테이블 권한
  ```sql
  GRANT SELECT ON employees.employees TO 'user'@'localhost';
  ```

## 3.5 역할(Role)

### 역할 생성 및 권한 부여

```sql
CREATE ROLE 'role_emp_read', 'role_emp_write';

GRANT SELECT ON employees.* TO 'role_emp_read';
GRANT INSERT, UPDATE, DELETE ON employees.* TO 'role_emp_write';
```

### 계정 생성 및 역할 부여

```sql
CREATE USER 'reader'@'127.0.0.1' IDENTIFIED BY 'password';
CREATE USER 'writer'@'127.0.0.1' IDENTIFIED BY 'password';

GRANT 'role_emp_read' TO 'reader'@'127.0.0.1';
GRANT 'role_emp_write' TO 'writer'@'127.0.0.1';
```

### 역할 활성화

```sql
SET ROLE 'role_emp_read';
-- 또는 모든 역할 자동 활성화
SET GLOBAL activate_all_roles_on_login = ON;
```

### 호스트 생략 시 기본값

```sql
CREATE ROLE 'role_test'; -- 동일: CREATE ROLE 'role_test'@'%';
```

### 역할과 계정의 호스트가 다를 경우

```sql
CREATE ROLE 'role_emp_local_read'@'localhost';
CREATE USER 'reader'@'localhost' IDENTIFIED BY 'qwerty';

GRANT SELECT ON employees.* TO 'role_emp_local_read'@'localhost';
GRANT 'role_emp_local_read'@'localhost' TO 'reader'@'127.0.0.1';
```

※ 역할을 직접 로그인 용도로 사용하려는 경우에만 호스트가 중요함.
```
